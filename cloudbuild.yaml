# Use custom service account
serviceAccount: projects/PROJECT-ID/serviceAccounts/firebase-adminsdk@PROJECT-ID.iam.gserviceaccount.com

# Store logs in your bucket
logsBucket: gs://my-build-logs-bucket12990

steps:
  # Step 1: Build Docker image
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'build'
      - '-t'
      - 'asia-south1-docker.pkg.dev/$PROJECT_ID/flask-app/flask-app:$SHORT_SHA'
      - './src'

  # Step 2: Push image to Artifact Registry
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'push'
      - 'asia-south1-docker.pkg.dev/$PROJECT_ID/flask-app/flask-app:$SHORT_SHA'

  # Step 3: Create Cloud Deploy release
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args:
      - 'deploy'
      - 'releases'
      - 'create'
      - 'release-$SHORT_SHA'
      - '--delivery-pipeline=flask-pipeline'
      - '--region=asia-south1'
      - '--images=flask-app=asia-south1-docker.pkg.dev/$PROJECT_ID/flask-app/flask-app:$SHORT_SHA'

images:
  - 'asia-south1-docker.pkg.dev/$PROJECT_ID/flask-app/flask-app:$SHORT_SHA'
